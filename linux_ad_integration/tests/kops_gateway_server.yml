---
- hosts: "tag_Name_ehe_development_{{ hostname }}"
  become: True
  become_user: root
  gather_facts: yes
  vars:
    ansible_user: ubuntu
    hostname: "kops_dev_gw"
    ssh_access_groups:
      - "CODA Dev Admins"
      - "CODA Dev Users"
    sudo_access:
      - "CODA Dev Admins"
      - "domain admins"
  vars_prompt:
    - name: admin_password
      prompt: "Please enter the password for {{ admin_user }}@{{ ldap_domain|upper }}"
      private: yes
  pre_tasks:
    - name: Install min python if needed
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
      changed_when: false
    - name: "Display all variables/facts known for {{ hostname }}"
      debug:
        var: hostvars[inventory_hostname]
        verbosity: 0
    - name: Install kops deployment tools with snap
      become_user: root
      vars:
        kopsnaps:
          - kubectl
          - helm
      shell: snap install "{{ item }}" --classic
      loop: "{{ kopsnaps }}"
  roles:
    - { role: "{{ playbook_dir }}/.." }
